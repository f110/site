---
title: Kubernetes v1.21 にアップデートした
date: 2021-06-24T17:12:00+09:00
isCJKLanguage: true
tags: [Homecluster]
---

Kubernetes を 1.21.2 にアップデートした。

少し前に 1.21 系にアップデートしようと思っていたが [1.21.1 にリグレッション](https://groups.google.com/g/kubernetes-sig-release/c/UW5rY4CbUbY) があり、すぐに次のパッチバージョンがリリースされるということだったので 1.21.2 を待っていた。

うちのクラスタは kubeadm で構築しつつその kubeadm は itamae で入れているので若干公式のアップグレードドキュメントとは異なる手順にはなるがそれほど大きな違いはない。
大まかに手順は

1. 対象ノードを drain してクラスタから外す
2. 一度ノードを reboot する（ゾンビプロセスなどが残っていると邪魔なのでクリーンにする）
3. k8s 関連のアップグレード作業
4. インストールされているパッケージのアップデート
5. ノードを reboot
6. 対象ノードをクラスタに戻す

という6ステップになる。

アップデートに伴って新たに出てきた Deprecation warning などには順次対応していきたい。
