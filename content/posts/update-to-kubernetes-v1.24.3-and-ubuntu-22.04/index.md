---
title: Kubernetes v1.24.3にアップデートした
date: 2022-07-17T20:23:00+09:00
isCJKLanguage: true
tags: [Homecluster]
---

大体いつも Kubernetes のリリースはいくつかパッチリリースがされてからアップデートしているので今回は v1.24.3 で自宅クラスタのアップデートをすることにした。

手順はいつもと同じで特に問題なかった。

しかし今回は OS のアップデートも一緒に行うことにしたのでこちらの方でトラブルがあった。

コントロールプレーンには Raspberry Pi を使っていてこれの OS も Ubuntu を使っているのだが Ubuntu 22.04 のラズパイ向けカーネルでは少しパッケージングが変わってしまい、カーネルモジュールの `8021q` が `linux-module-extras` に移動してしまった。

自宅クラスタのネットワークではタグ VLAN を使っているのでこのモジュールが必要だった。
しかしこのモジュールのパッケージングが `linux-modules` から `linux-module-extras` に移動したことで `do-release-upgrade` をして再起動すると疎通しなくなってしまう。

ラズパイの画面を表示する機材を用意してないので疎通しなくなってしまった場合はクリーンインストールするしかない。

なおこの問題は次のカーネル（`5.15.0-1012.14`）で修正される予定になっている。

なのでこの問題に遭遇してしまった1台はクリーンインストールした上で `linux-module-extras` をインストールして問題を解決した。残りの2台は OS のアップデートをペンディングしているので次のカーネルが updates リポジトリに入ったらアップデートを行いたい。
